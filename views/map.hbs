<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCJ8wDa0Y7m3dFsKwNaTPEsZD5AR3kq5Dc&callback=initMap"></script>


  <div id="map" style="width:700px; height:500px"></div>


<script type="text/javascript">
  var map;
  function initMap() {
    console.log('initMap called');
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 41.889141, lng: -87.688119}, //chicago-ish
      zoom: 13 // bigger is closer
    });
    dataCalling(map);
  }


  var data;
  var mapData;

  function dataCalling(map) {
    var infoWindows = [];
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "/location/get-session", false);
    xhr.onload = function() {
      if (xhr.readyState != XMLHttpRequest.DONE) {
        return;
      }
      if (xhr.status == 200) {
        console.log("query successful");
        var response = JSON.parse(xhr.responseText);
        // console.log(response);
        mapData = response;
        // console.log(mapData);
        setMarkers(mapData, map);
      };
    };
    xhr.send(null);
  }







function setMarkers(mapData, map) {
  console.log("setMarkers called");
  data = mapData;
  var marker = [];
  for (var i = 0; i < data.length; i++) {
    var place = data[i];
    console.log("call markerItem");
    marker[i] = new markerItem(place, map);


    // var infoWindow = new google.maps.InfoWindow({
    //   content: beach[3],
    //   maxWidth: 200
    // });
    //
    // var image = {
    //   url: 'orange-pin.png',
    //   size: new google.maps.Size(30, 44)
    //   // origin: new google.maps.Point(0,0),
    //   // anchor: new google.maps.Point(0, 0)
    // };
    //
    // marker[i] = new google.maps.Marker({
    //   position: {lat: beach[1], lng: beach[2]},
    //   map: map,
    //   title: beach[0],
    //   icon: image
    // });
    // marker[i].addListener('click', function() {
    //   infoWindow.open(map, marker[i]);
    // });

  }
}

var markerItem = function(data, map) {
  // this.infoWindow = new google.maps.InfoWindow({
  //   content: data[3],
  //   maxWidth: 200
  // });
  this.image = {
    url: '/images/orange-pin.png',
    size: new google.maps.Size(30, 44)
    // origin: new google.maps.Point(0,0),
    // anchor: new google.maps.Point(0, 0)
  };

  this.marker = new google.maps.Marker({
    position: {lat: data.coords[1], lng: data.coords[0]},
    map: map,
    title: data.name,
    icon: this.image
  });

  // var winda = this.infoWindow;
  var marka = this.marker;
  this.marker.addListener('click', function() {
    // send the locationID to the session variable


    // for (var i=0;i<infoWindows.length;i++) {
    //    infoWindows[i].close();
    // }
    // console.log(data[0]);
    // var infowindow = new google.maps.InfoWindow();
    // var content = '<div id="content">'+
    //   '<div id="siteNotice">'+
    //   '</div>'+
    //   '<h1 id="firstHeading" class="firstHeading">' + data.name + '</h1>'+
    //   '<div id="address">'+
    //   '<p>' + data.address + '</p>' +
    //   '<p>' + data.burgers[0].name + '</p>' +
    //   '<p>Rating: ' + data.burgers[0].rating + ' out of 4</p>' +
    //   '<p><img src="' + data.burgers[0].image + '" alt="" /></p>' +
    //   '<input type="button" value="Button">';
    //
    // var content = '<div class="ui horizontal segments">' +
    //   '<div class="ui segments">' +
    //     '<h1 id="location_name" class="ui segment">' + data.name +
    //     '</h1>' +
    //     '<div id="location_price" class="ui segment">' +
    //       '<div id="location_price" class="zero_dollar price">$</div>' +
    //       '<div id="location_price" class="one_dollar price">$</div>' +
    //       '<div id="location_price" class="two_dollar price">$</div>' +
    //       '<div id="location_price" class="three_dollar price">$</div>' +
    //     '</div>' +
    //   '</div>' +
    //
    //   '<div id="location_image" class="ui segment">' +
    //     '<img src="' + data.image + '" alt="" />' +
    //   '</div>' +
    //
    // '</div>' +
    //
    // '<div class="ui horizontal segments">' +
    //
    //   '<div id="location_address" class="ui segment">' +
    //     data.address +
    //   '</div>' +
    //   '<div id="location_hours" class="ui segment">' +
    //     '<p>' + data.hours[0].days + '</p>' +
    //     '<p>Opens: ' + data.hours[0].opening + '</p>' +
    //     '<p>Closes: ' + data.hours[0].closing + '</p>' +
    //   '</div>' +
    //   '<div id="location_phone" class="ui segment">' +
    //     data.phone +
    //   '</div>';
    //   <div id="location_website" class="ui segment">
    //     THIS WILL BE THE WEBSITE
    //   </div>
    //
    // </div>
    //
    //
    // <div id="location_byob">BYOB</div>
    // <div id="location_alcohol">Alcohol</div>
    // <div id="location_latenight">Late Night</div>
    // <div id="location_outdoor">Outdoor</div>
    // <div id="location_challenges">Challenges</div>
    // <div id="location_allergies">Allergies</div>
    // <div id="location_burgers">Burgers</div>
    // <div id="location_sides">Sides</div>



    // <button class="ui icon button">
    //   <i class="checkmark icon yes"></i>
    // </button>
    // <button class="ui icon button">
    //   <i class="minus icon no"></i>
    // </button>
    //
    // <!-- <i class="minus icon"></i>
    // <i class="checkmark icon"></i> -->
    // <!-- <div id="location_foodtruck">Food Truck</div> -->
    // <div id="location_foodtruck" class="yes">-</div>
    // <div id="location_foodtruck" class="no">-</div>
    //
    // <div id="location_foodtruck" class="yes">-</div>
    // <div id="location_foodtruck" class="no">-</div>
    //
    // <div id="location_foodtruck" class="yes">-</div>
    // <div id="location_foodtruck" class="no">-</div>
    //
    // <div id="location_foodtruck" class="yes">-</div>
    // <div id="location_foodtruck" class="no">-</div>
    //
    // <div id="location_foodtruck" class="yes">-</div>
    // <div id="location_foodtruck" class="no">-</div>


    infowindow.setContent(content);
    infoWindows.push(infowindow);
    infowindow.open(map, marka);
    // winda.open(map, marka);
  });
}


//   // Try HTML5 geolocation.
//   // ...my browser blocks the geolocation for local files
//   if (navigator.geolocation) {
//     navigator.geolocation.getCurrentPosition(function(position) {
//       var pos = {
//         lat: position.coords.latitude,
//         lng: position.coords.longitude
//       };
//
//       map.setCenter(pos);
//     }, function() {
//       handleLocationError(true, infoWindow, map.getCenter());
//     })
//   } else {
//     // Browser doesn't support Geolocation
//     handleLocationError(false, infoWindow, map.getCenter());
//   }
//
// function handleLocationError(browserHasGeolocation, infoWindow, pos) {
//   infoWindow.setPosition(pos);
//   infoWindow.setContent(browserHasGeolocation ?
//                         'Error: The Geolocation service failed.' :
//                         'Error: Your browser doesn\'t support geolocation.');
// }


</script>
